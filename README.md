# Nutrition Bot

Telegram-–±–æ—Ç –¥–ª—è —É—á—ë—Ç–∞ –ø–∏—Ç–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–∫—Å—Ç–∞, –≥–æ–ª–æ—Å–∞ –∏ —Ñ–æ—Ç–æ.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –µ–¥—ã** —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ–æ—Ç–æ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ö–ë–ñ–£** (–∫–∞–ª–æ—Ä–∏–∏, –±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã, –∫–ª–µ—Ç—á–∞—Ç–∫–∞)
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π** –∑–∞ –ª—é–±–æ–π –¥–µ–Ω—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `/day`
- **Inline-–∫–Ω–æ–ø–∫–∏** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏:
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥—Ä–∞–º–º–æ–≤
  - –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π –Ω–∞ –≤—á–µ—Ä–∞
  - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è** - –∞–Ω–∫–µ—Ç–∞ –¥–ª—è –∑–∞—è–≤–∫–∏ —Ç—Ä–µ–Ω–µ—Ä—É
- **–ò–Ω–±–æ–∫—Å —Ç—Ä–µ–Ω–µ—Ä–∞** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- **–ú–µ—Ç—Ä–∏–∫–∏ MVP** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞** - rate limiting –∏ —Ç–∞–π–º–∞—É—Ç—ã

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** + **Grammy.js** (Telegram Bot API)
- **PostgreSQL** (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- **OpenAI API** (GPT-4o-mini, Whisper, Vision)
- **Docker** (–¥–ª—è PostgreSQL)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/progprogect/NutritionBot.git
cd NutritionBot
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:
```env
BOT_TOKEN=your_telegram_bot_token
DATABASE_URL=postgresql://postgres:postgres@localhost:5433/foodbot
OPENAI_API_KEY=your_openai_api_key
ADMIN_TG_ID=your_telegram_id
TRAINER_TG_ID=trainer_telegram_id
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL —á–µ—Ä–µ–∑ Docker:
```bash
docker run --name foodbot-db -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=foodbot -p 5433:5432 -d postgres
```

5. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
psql "postgresql://postgres:postgres@localhost:5433/foodbot" -f migrations/2025-09-22-add-items-and-cache.sql
psql "postgresql://postgres:postgres@localhost:5433/foodbot" -f migrations/2025-09-22-metrics.sql
psql "postgresql://postgres:postgres@localhost:5433/foodbot" -f migrations/2025-09-22-coach-requests.sql
```

6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
node index.js
```

## üìã –ö–æ–º–∞–Ω–¥—ã

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/start` - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/day` - –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- `/day –≤—á–µ—Ä–∞` - –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ –≤—á–µ—Ä–∞
- `/day 21.09.2025` - –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É
- `/myid` - –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π Telegram ID

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- `/mvpstats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞

### –î–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤
- `/inbox` - –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫
- `/inbox in_progress` - –∑–∞—è–≤–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ
- `/inbox done` - –≥–æ—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏
- `/inbox rejected` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `food_entries` - –∑–∞–ø–∏—Å–∏ –æ –µ–¥–µ
- `food_items` - –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –ö–ë–ñ–£
- `coach_requests` - –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã
- `metrics_events` - –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `llm_cache` - –∫—ç—à –æ—Ç–≤–µ—Ç–æ–≤ LLM

## üîß API

### OpenAI Integration
- **GPT-4o-mini** - –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –æ –µ–¥–µ
- **Whisper** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Vision** - –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –µ–¥—ã

### Structured Outputs
–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON Schema –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç OpenAI API.

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–ë–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
- DAU (Daily Active Users)
- –¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Ç–µ–∫—Å—Ç, –≥–æ–ª–æ—Å, —Ñ–æ—Ç–æ)
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API
- –û—à–∏–±–∫–∏

## üö¶ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **Rate limiting**: 8 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–∞–π–º–∞—É—Ç—ã**: 8 —Å–µ–∫ (—Ç–µ–∫—Å—Ç), 15 —Å–µ–∫ (–≥–æ–ª–æ—Å/—Ñ–æ—Ç–æ)
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ**: –º–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥
- **–î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º**: —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
foodbot/
‚îú‚îÄ‚îÄ index.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ llm.js                # OpenAI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ vision.js             # Vision API
‚îú‚îÄ‚îÄ migrations/           # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ scripts/test/         # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îî‚îÄ‚îÄ README.md
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
node scripts/test/test-date-parsing.js

# –¢–µ—Å—Ç –∏–Ω–±–æ–∫—Å–∞ —Ç—Ä–µ–Ω–µ—Ä–∞
node scripts/test/test-trainer-inbox.js

# –¢–µ—Å—Ç —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–æ–∫
node scripts/test/test-trainer-status.js
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë• –ê–≤—Ç–æ—Ä—ã

- [progprogect](https://github.com/progprogect)

## üîó –°—Å—ã–ª–∫–∏

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Grammy.js](https://grammy.dev/)
- [OpenAI API](https://platform.openai.com/)
- [PostgreSQL](https://www.postgresql.org/)
